# 📅 开发日志与文档更新计划 (2025-12-28)

## 1. 核心任务：文档更新
我将根据今天的开发进展和您提出的遗留问题，更新项目文档。

### 📄 更新 `opportunity_system/docs/DEV_LOG.md`
- **记录日期**: 2025-12-28
- **完成事项**:
    - **项目看板 (ProjectBoard)**: 实现了卡片的多选、批量启/停、基础导出(Markdown)及删除功能。
    - **时间轴 (Timeline)**:
        - **项目级**: 实现了基于阶段 (S1/S2/S3) 分组的甘特图视图 (`ProjectTimeline`)。
        - **全局级**: 实现了跨项目的全局时间轴概览 (`GlobalTimeline`)。
    - **卡片编辑 (CardEditor)**: 集成了模态框编辑器与 AI 润色按钮（后端 `optimize_card` 接口）。
    - **后端修复**: 修正了 `test_sync.py` 的环境配置问题，验证了 `perform_update` 的同步逻辑。
- **遇到的问题 (Recurring Errors)**:
    - **构建失败**: 前端 TypeScript 类型检查 (`vue-tsc`) 报错导致构建失败 (例如 `onMounted` 未使用、对象可能为 `undefined`)。
    - **AI 集成不稳定**: 卡片 AI 润色功能调用失败，需排查后端 LLM 返回格式或连接问题。
    - **UI/UX 差距**: 新版后台 (`16lily`) 与原 `project_cards` 项目在美观度、科技感上存在明显差距。
    - **功能完成度**: 卡片内容粘贴无法自动解析，部分按钮（Excel导出、预算统计）仅为占位符。

### 📄 更新 `opportunity_system/docs/ROADMAP.md`
- **新增 Phase 3.6: UI/UX 深度重构 (Visual Overhaul)**
    - **目标**: 对标 `project_cards` 项目，引入更具科技感和时尚感的设计语言。
    - **任务**: 移植 `project_cards` 的 CSS/Assets，重写看板与时间轴样式。
- **新增 Phase 5.1: 商机全生命周期审计 (Opportunity Audit Trail)**
    - **目标**: 记录商机的所有变更细节（经办人、金额、阶段、交付物等）。
    - **任务**:
        - 设计 `OpportunityChangeLog` 模型（记录 field, old_value, new_value, actor, timestamp）。
        - 在商机详情页增加“变更历史”标签页。
        - 集成审批流记录。

## 2. 待办事项 (Todo) - 明日计划
1.  **修复卡片编辑器**:
    - [ ] 实现“粘贴即解析”逻辑，支持从 Markdown 或纯文本智能提取字段。
    - [ ] 修复 AI 润色接口的报错，确保 JSON 返回格式稳定。
2.  **UI 升级**:
    - [ ] 按照 `project_cards` 风格重写 `ProjectTimeline.vue` 的 CSS。
    - [ ] 优化 `ProjectBoard.vue` 的卡片样式与交互动画。
3.  **商机审计日志**:
    - [ ] 设计并实现商机变更追踪功能。
4.  **构建修复**:
    - [ ] 清理前端 TypeScript 报错，确保 `npm run build` 顺利通过。

---

**确认**: 如果您同意上述文档更新计划，我将立即执行文件写入操作。